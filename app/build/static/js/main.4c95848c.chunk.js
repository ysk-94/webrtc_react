(this.webpackJsonpinnstudio=this.webpackJsonpinnstudio||[]).push([[0],{26:function(e,t,a){e.exports=a(60)},31:function(e,t,a){},32:function(e,t,a){},59:function(e,t,a){},60:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(18),s=a.n(o),c=(a(31),a(5)),i=a(4),m=a(3),l=a(62),u=(a(32),function(e){var t=Object(l.a)(),a=Object(r.useState)(""),o=Object(c.a)(a,2),s=o[0],m=o[1];return n.a.createElement("div",{className:"entry"},n.a.createElement("div",null,n.a.createElement("h1",{className:"entry__logo"},"INN-STUDIO"),n.a.createElement("div",{className:"entry__formBox"},n.a.createElement("p",{className:"entry__formBody"},"INN-STUDIO\u3067\u9060\u304f\u96e2\u308c\u305f\u4eba\u3068\u306e\u30d3\u30c7\u30aa\u901a\u8a71\u3092\u697d\u3057\u307f\u307e\u3057\u3087\u3046\u3002"),n.a.createElement("div",{className:"entry__row entry__row--1"}),n.a.createElement("form",{className:"entry__form"},n.a.createElement("div",{className:"entry__row entry__row--flex"},n.a.createElement("input",{className:"entry__form__input",id:"name",type:"text",onChange:function(t){return function(t){e.setUserName(t.target.value)}(t)},placeholder:"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u5165\u529b"}),n.a.createElement("input",{style:{marginTop:"8px"},className:"entry__form__input",id:"roomId",type:"text",onChange:function(e){return function(e){m(e.target.value)}(e)},placeholder:"ROOMID\u3092\u5165\u529b\uff08JOIN\u306e\u307f\uff09"}),n.a.createElement("p",{className:"entry__note"},"\u203bRoom\u3092\u65b0\u898f\u4f5c\u6210\u3059\u308b\u5834\u5408\u3001ROOMID\u306f\u81ea\u52d5\u3067\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002"),n.a.createElement("div",{className:"entry__row"},n.a.createElement(i.b,{className:"entry__newLink",to:"/rooms/".concat(t)},"\u65b0\u898f\u4f5c\u6210"),n.a.createElement(i.b,{className:"entry__joinLink",to:"/rooms/".concat(s)},"JOIN")))))),n.a.createElement("p",{className:"copyright"},"\xa9 2020 ysk."))}),d=a(6),f=a.n(d),g=a(13),p=a(21),v=a(22),h=a(24),_=a(25),E=a(23),y=new(a.n(E).a)({key:"5630df90-6dd1-4ed9-9585-9469ecd49dd8",debug:0}),b=function(e){var t=Object(r.useState)(""),a=Object(c.a)(t,2),o=a[0],s=a[1];return n.a.createElement("div",{className:"room__form"},n.a.createElement("input",{id:"message",className:"room__form__input",type:"text",value:o,onChange:function(e){return s(e.target.value)},placeholder:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b"}),n.a.createElement("a",{className:"room__form__send",onClick:function(){return e.sendMessage(o),void s("")}},"\u9001\u4fe1"))},N=(a(59),function(e){Object(_.a)(a,e);var t=Object(h.a)(a);function a(e){var r;return Object(p.a)(this,a),(r=t.call(this,e)).isInit=void 0,r.room=void 0,r.roomId=void 0,r.localVideoRef=void 0,r.remoteVideoRefs=void 0,r.remoteStreams=void 0,r.userName=void 0,r.isInit=!1,r.roomId=r.props.match.params.roomId,r.localVideoRef=n.a.createRef(),r.remoteVideoRefs={},r.remoteStreams={},r.state={remoteVideos:[],messages:[]},""!==e.userName&&e.userName?r.userName=e.userName:r.userName="\u30e6\u30fc\u30b6\u30fc",r}return Object(v.a)(a,[{key:"init",value:function(){var e=Object(g.a)(f.a.mark((function e(){var t,a,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.open){e.next=5;break}return alert("\u30b5\u30fc\u30d0\u30fc\u672a\u63a5\u7d9a\u30a8\u30e9\u30fc"),e.abrupt("return");case 5:this.isInit=!0;case 6:return e.next=8,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 8:return t=e.sent,this.localVideoRef.current.srcObject=t,e.next=12,this.localVideoRef.current.play().catch(console.error);case 12:(a=y.joinRoom(this.roomId,{mode:"sfu",stream:t})).once("open",(function(){alert("Room: ".concat(r.roomId," \u3078\u3088\u3046\u3053\u305d"))})),a.on("peerJoin",(function(e){var t=Object.assign([],r.state.messages);t.push({user:"SYSTEM",message:"\u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u304c\u53c2\u52a0\u3057\u307e\u3057\u305f\u3002"}),r.setState({messages:t})})),a.on("stream",function(){var e=Object(g.a)(f.a.mark((function e(t){var a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.remoteVideoRefs[t.peerId]=n.a.createRef(),a=n.a.createElement("video",{id:t.peerId,key:t.peerId,ref:r.remoteVideoRefs[t.peerId],playsInline:!0,autoPlay:!0}),r.remoteStreams[t.peerId]=t,(o=Object.assign({},r.state.remoteVideos))[t.peerId]=a,r.setState({remoteVideos:o});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.on("peerLeave",(function(e){var t=Object.assign({},r.state.remoteVideos);t[e]=null,r.setState({remoteVideos:t})})),a.on("data",(function(e){var t=e.data,a=(e.src,JSON.parse(t)),n=Object.assign([],r.state.messages);n.push({user:a.user,message:a.message}),r.setState({messages:n})})),a.once("close",(function(){r.setState({remoteVideos:null})})),this.room=a,y.on("error",console.error);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.isInit||this.init()}},{key:"componentDidUpdate",value:function(){var e=this;Object.keys(this.remoteVideoRefs).forEach((function(t){var a=e.remoteVideoRefs[t].current;a&&!a.srcObject&&(a.srcObject=e.remoteStreams[t])}))}},{key:"componentWillUnmount",value:function(){}},{key:"toggleMuteAudio",value:function(e){this.localVideoRef.current.srcObject.getAudioTracks().forEach((function(t){t.enabled=!t.enabled,t.enabled?e.target.src="/img/mic.png":e.target.src="/img/mic--muted.png"}))}},{key:"toggleMuteVideo",value:function(e){this.localVideoRef.current.srcObject.getVideoTracks().forEach((function(t){t.enabled=!t.enabled,t.enabled?e.target.src="/img/movie.png":e.target.src="/img/movie--muted.png"}))}},{key:"sendMessage",value:function(e){var t={user:this.userName,message:e};this.room.send(JSON.stringify(t));var a=Object.assign([],this.state.messages);a.push({user:"me",message:e}),this.setState({messages:a})}},{key:"render",value:function(){var e=this,t=this.state.remoteVideos?Object.values(this.state.remoteVideos):null,a=this.state.messages.map((function(e){return n.a.createElement("p",{style:{wordWrap:"break-word",padding:"0 12px"}},e.user,": ",e.message)}));return n.a.createElement("div",{className:"room"},n.a.createElement("div",{className:"room__remoteVideos"},n.a.createElement("video",{id:"localStream",ref:this.localVideoRef,muted:!0,playsInline:!0}),t),n.a.createElement("div",{className:"room__footer"},n.a.createElement("h2",{style:{color:"#333",padding:"12px"}},"ROOMID:",n.a.createElement("br",null)," ",this.roomId),n.a.createElement("div",{className:"room_messages"},a),n.a.createElement(b,{sendMessage:function(t){return e.sendMessage(t)}}),n.a.createElement("div",{className:"room__manuBox"},n.a.createElement("img",{width:"30",height:"30",src:"/img/mic.png",onClick:function(t){return e.toggleMuteAudio(t)}}),n.a.createElement("img",{width:"30",height:"30",src:"/img/movie.png",onClick:function(t){return e.toggleMuteVideo(t)}}),n.a.createElement(i.b,{className:"room__close",to:"/"},"\u63a5\u7d9a\u7d42\u4e86"))))}}]),a}(n.a.Component)),O=function(){var e=Object(r.useState)(""),t=Object(c.a)(e,2),a=t[0],o=t[1];return n.a.createElement(n.a.Fragment,null,n.a.createElement(i.a,null,n.a.createElement(m.a,{exact:!0,path:"/",render:function(){return n.a.createElement(u,{setUserName:o,userName:a})}}),n.a.createElement(m.a,{path:"/rooms/:roomId",render:function(e){return n.a.createElement(N,Object.assign({},e,{userName:a}))}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(O,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.4c95848c.chunk.js.map